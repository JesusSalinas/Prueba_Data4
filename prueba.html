<!DOCTYPE html>
<html ng-app="Root">
    <head>
        <meta charset="utf-8">
        <title>D3 Test</title>
        <script src="http://d3js.org/d3.v3.min.js"></script>
        <style>
        #Tolds {
          width: 700px;
          height: 700px;
        }
        </style>
    </head>
    <body>
        <!--
        <script type="text/javascript">
          var dataset = [ 5, 10, 15, 20, 25];
          d3.select("body").selectAll("div")
          .data(dataset)
          .enter()
          .append("div")
          .attr("class", "bar")
          //.text(function(d) { return d; })
          .style("height", function(d) {
            var barHeight = d * 5;  //Incrementar la escala 5 veces.
            return barHeight + "px";
          });
        </script>
        -->

        <div id="Tolds">

        </div>

        <div ng-controller="Ctrl">
          <d3-bars data="d3Data"></d3-bars>
        </div>


        <script type="text/javascript">
          angular.module('Root.directives')
            .directive('d3Bars', ['d3Service', function(d3Service) {
              return {
                restrict: 'EA',
                scope: {},
                link: function(scope, element, attrs) {
                  d3Service.d3().then(function(d3) {
                    var svg = d3.select(ele[0])
                    .append('svg')
                    .style('width', '100%');

        // Browser onresize event
        window.onresize = function() {
          scope.$apply();
        };

        // hard-code data
        scope.data = [
          {name: "Greg", score: 98},
          {name: "Ari", score: 96},
          {name: 'Q', score: 75},
          {name: "Loser", score: 48}
        ];

        // Watch for resize event
        scope.$watch(function() {
          return angular.element($window)[0].innerWidth;
        }, function() {
          scope.render(scope.data);
        });

        scope.render = function(data) {
          // our custom d3 code
        }
      });
    }};
}]);

          var dataset = [ 5, 10, 13, 19, 21, 25, 22, 18, 15, 13,11, 12, 15, 20, 18, 17, 16, 18, 23, 25 ];
          var w = 600;
          var h = 200;
          var barPadding = 1;                                 // <-- Nueva!
          var svg = d3.select("#Tolds")
            .append("svg")
            .attr("width", w)
            .attr("height", h);
          svg.selectAll("rect")
            .data(dataset)
            .enter()
            .append("rect")
            .attr("x", function(d, i) {
              return i * (w / dataset.length);
            })
            .attr("y", function(d) {
              return h - (d*4);                                    //Altura menos el dato
            })
            .attr("width", w / dataset.length - barPadding)
            .attr("height", function(d) {
              return d * 4;                                         //Solo el dato
            })
            //.attr("fill", "teal");
            .attr("fill", function(d) {
              return "rgb(0, 0, " + (d * 10) + ")";
            });

          svg.selectAll("text")
            .data(dataset)
            .enter()
            .append("text")
            .text(function(d) {
              return d;
            })
            .attr("x", function(d, i) {
              return i * (w / dataset.length) + 13;  // +5
            })
            .attr("y", function(d) {
              return h - (d * 4) + 15;              // +15
            })
            .attr("font-family", "sans-serif")
            .attr("font-size", "11px")
            .attr("fill", "white")
            .attr("text-anchor", "middle");


          /*

          d3.select("body").selectAll("div")
            .data(dataset)
            .enter()
            .append("div")
            .attr("class", "bar")
            .style("height", function(d) {
                var barHeight = d * 5;
                return barHeight + "px";
          });*/
        </script>



    </body>
</html>
